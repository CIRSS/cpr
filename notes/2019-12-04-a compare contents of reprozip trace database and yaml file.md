## 2019-12-04-a Compare contents of ReproZip trace database and YAML file

### Inspect contents of the `config.yml` file in the `.reprozip-trace` directory
 - For the example trace of two runs of `reprozip trace date` performed yesterday, dumped the contents of the `config.yml` file here:
	```yaml
	# ReproZip configuration file
	# This file was generated by reprozip 1.0.16 at 2019-12-03T21:14:42-08:00

	# You might want to edit this file before running the packer
	# See 'reprozip pack -h' for help

	# Run info
	version: "0.8"
	runs:
	# Run 0
	- architecture: x86_64
	  argv:
	  - date
	  binary: /bin/date
	  distribution:
	  - ubuntu
	  - '18.04'
	  environ:
	    DISPLAY: localhost:10.0
	    HOME: /home/tmcphill
	    LANG: en_US.UTF-8
	    LESSCLOSE: /usr/bin/lesspipe %s %s
	    LESSOPEN: '| /usr/bin/lesspipe %s'
	    LOGNAME: tmcphill
	    LS_COLORS: 'rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:'
	    MAIL: /var/mail/tmcphill
	    OLDPWD: /home/tmcphill/GitRepos/wt-prov-model/toolkits/reprozip
	    PATH: /linfast/GitRepos/wt-prov-model/toolkits/reprozip/.venv-reprozip/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/cuda-10.0/bin
	    PS1: '(.venv-reprozip) \[\e]0;\u@\h: \w\a\]${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '
	    PWD: /home/tmcphill/GitRepos/wt-prov-model/toolkits/reprozip/scratch
	    SHELL: /bin/bash
	    SHLVL: '1'
	    SSH_CLIENT: 172.24.1.245 54255 22
	    SSH_CONNECTION: 172.24.1.245 54255 172.24.1.247 22
	    SSH_TTY: /dev/pts/2
	    TERM: xterm
	    USER: tmcphill
	    VIRTUAL_ENV: /linfast/GitRepos/wt-prov-model/toolkits/reprozip/.venv-reprozip
	    XDG_DATA_DIRS: /usr/local/share:/usr/share:/var/lib/snapd/desktop
	    XDG_RUNTIME_DIR: /run/user/1000
	    XDG_SESSION_ID: '6'
	    _: /linfast/GitRepos/wt-prov-model/toolkits/reprozip/.venv-reprozip/bin/reprozip
	  exitcode: 0
	  gid: 1000
	  hostname: artemis
	  id: run0
	  system:
	  - Linux
	  - 4.15.0-72-generic
	  uid: 1000
	  workingdir: /linfast/GitRepos/wt-prov-model/toolkits/reprozip/scratch

	# Run 1
	- architecture: x86_64
	  argv:
	  - date
	  binary: /bin/date
	  distribution:
	  - ubuntu
	  - '18.04'
	  environ:
	    DISPLAY: localhost:10.0
	    HOME: /home/tmcphill
	    LANG: en_US.UTF-8
	    LESSCLOSE: /usr/bin/lesspipe %s %s
	    LESSOPEN: '| /usr/bin/lesspipe %s'
	    LOGNAME: tmcphill
	    LS_COLORS: 'rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=00:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.zst=01;31:*.tzst=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.wim=01;31:*.swm=01;31:*.dwm=01;31:*.esd=01;31:*.jpg=01;35:*.jpeg=01;35:*.mjpg=01;35:*.mjpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=00;36:*.au=00;36:*.flac=00;36:*.m4a=00;36:*.mid=00;36:*.midi=00;36:*.mka=00;36:*.mp3=00;36:*.mpc=00;36:*.ogg=00;36:*.ra=00;36:*.wav=00;36:*.oga=00;36:*.opus=00;36:*.spx=00;36:*.xspf=00;36:'
	    MAIL: /var/mail/tmcphill
	    OLDPWD: /home/tmcphill/GitRepos/wt-prov-model/toolkits/reprozip
	    PATH: /linfast/GitRepos/wt-prov-model/toolkits/reprozip/.venv-reprozip/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/cuda-10.0/bin
	    PS1: '(.venv-reprozip) \[\e]0;\u@\h: \w\a\]${debian_chroot:+($debian_chroot)}\u@\h:\w\$ '
	    PWD: /home/tmcphill/GitRepos/wt-prov-model/toolkits/reprozip/scratch
	    SHELL: /bin/bash
	    SHLVL: '1'
	    SSH_CLIENT: 172.24.1.245 57990 22
	    SSH_CONNECTION: 172.24.1.245 57990 172.24.1.247 22
	    SSH_TTY: /dev/pts/2
	    TERM: xterm
	    USER: tmcphill
	    VIRTUAL_ENV: /linfast/GitRepos/wt-prov-model/toolkits/reprozip/.venv-reprozip
	    XDG_DATA_DIRS: /usr/local/share:/usr/share:/var/lib/snapd/desktop
	    XDG_RUNTIME_DIR: /run/user/1000
	    XDG_SESSION_ID: '4'
	    _: /linfast/GitRepos/wt-prov-model/toolkits/reprozip/.venv-reprozip/bin/reprozip
	  exitcode: 0
	  gid: 1000
	  hostname: artemis
	  id: run1
	  system:
	  - Linux
	  - 4.15.0-72-generic
	  uid: 1000
	  workingdir: /linfast/GitRepos/wt-prov-model/toolkits/reprozip/scratch

	# Input and output files

	# Inputs are files that are only read by a run; reprounzip can replace these
	# files on demand to run the experiment with custom data.
	# Outputs are files that are generated by a run; reprounzip can extract these
	# files from the experiment on demand, for the user to examine.
	# The name field is the identifier the user will use to access these files.
	inputs_outputs:

	# Files to pack
	# All the files below were used by the program; they will be included in the
	# generated package

	# These files come from packages; we can thus choose not to include them, as it
	# will simply be possible to install that package on the destination system
	# They are included anyway by default
	packages:
	  - name: "coreutils"
	    version: "8.28-1ubuntu1"
	    size: 6717440
	    packfiles: true
	    files:
	      # Total files used: 98.21 KB
	      # Installed package size: 6.41 MB
	      - "/bin/date" # 98.21 KB
	  - name: "libc6"
	    version: "2.27-3ubuntu1"
	    size: 12162048
	    packfiles: true
	    files:
	      # Total files used: 2.10 MB
	      # Installed package size: 11.60 MB
	      - "/lib/x86_64-linux-gnu/ld-2.27.so" # 166.95 KB
	      - "/lib/x86_64-linux-gnu/libc-2.27.so" # 1.94 MB
	      - "/lib/x86_64-linux-gnu/libc.so.6" # Link to /lib/x86_64-linux-gnu/libc-2.27.so
	  - name: "tzdata"
	    version: "2019c-0ubuntu0.18.04"
	    size: 3106816
	    packfiles: true
	    files:
	      # Total files used: 2.78 KB
	      # Installed package size: 2.96 MB
	      - "/usr/share/zoneinfo/America/Los_Angeles" # 2.78 KB

	# These files do not appear to come with an installed package -- you probably
	# want them packed
	other_files:
	  - "/etc/ld.so.cache" # 130.37 KB
	  - "/etc/localtime" # Link to /usr/share/zoneinfo/America/Los_Angeles
	  - "/lib64/ld-linux-x86-64.so.2" # Link to /lib/x86_64-linux-gnu/ld-2.27.so
	  - "/linfast/GitRepos/wt-prov-model/toolkits/reprozip/scratch" # Directory
	  - "/usr/lib/locale/locale-archive" # 2.87 MB

	# If you want to include additional files in the pack, you can list additional
	# patterns of files that will be included
	additional_patterns:
	# Example:
	#  - /etc/apache2/**  # Everything under apache2/
	#  - /var/log/apache2/*.log  # Log files directly under apache2/
	#  - /var/lib/lxc/*/rootfs/home/**/*.py  # All Python files of all users in
	#    # that container
	```
### Identified YAML file contents not stored in the database

- The YAML file organization appears to be as follows. Comments are my own.  Information not present in the SQLite database is marked NOT IN DATABASE.
	```yaml
	version: "0.8" 	# NOT IN DATABASE  This is presumably the version of the JSON schema (ReproZip version is 1.016)
	
	runs:			# This is the list of runs recorded in the trace.  The two items in the list
					# in this instance correspond to rows with `run_id` equal to 0 and 1 in the
					# database tables.

					# The list item included here corresponds to run 0 in the database. 
					# Much of the run-time environment information below is NOT IN DATABASE.
					
		- architecture: x86_64 		# NOT IN DATABASE
	      argv:                
	        - date
	      binary: /bin/date
	      distribution:
			  - ubuntu				# NOT IN DATABASE
			  - '18.04'				# NOT IN DATABASE
		  environ:					# NOT COMPLETE IN DATABASE (only first 1516 characters of env string)
			DISPLAY: localhost:10.0
		    HOME: /home/tmcphill
			. . .
		  exitcode: 0
		  gid: 1000					# NOT IN DATABASE
		  hostname: artemis			# NOT IN DATABASE
		  id: run0
		  system:
			  - Linux				# NOT IN DATABASE
			  - 4.15.0-72-generic	# NOT IN DATABASE
		  uid: 1000					# NOT IN DATABASE
		  workingdir: /linfast/GitRepos/wt-prov-model/toolkits/reprozip/scratch

	. . .
	
	inputs_outputs:	# This is where data files input or output by the run would be listed. 
					# This is empty for these runs here, but in the database there are five
					# 'accessed files' associated with each run.  The distinction between
					# files used to execute the run (listed below) and those read or written
					# explicitly by the run (which presumably would be listed here) is 
					# NOT IN DATABASE.
	
	packages:		# This is a list of packages installed on the host system that provide
					# the files listed for each that the runs use.
					# Except for the paths to the four files, this info is NOT IN DATABASE.

	  - name: "coreutils"
	    version: "8.28-1ubuntu1"
		size: 6717440
	    packfiles: true
	    files:
	      # Total files used: 98.21 KB
	      # Installed package size: 6.41 MB
	      - "/bin/date" # 98.21 KB
	  - name: "libc6"
	    version: "2.27-3ubuntu1"
	    size: 12162048
	    packfiles: true
	    files:
	      # Total files used: 2.10 MB
	      # Installed package size: 11.60 MB
	      - "/lib/x86_64-linux-gnu/ld-2.27.so" # 166.95 KB
	      - "/lib/x86_64-linux-gnu/libc-2.27.so" # 1.94 MB
	      - "/lib/x86_64-linux-gnu/libc.so.6" # Link to /lib/x86_64-linux-gnu/libc-2.27.so
	  - name: "tzdata"
	    version: "2019c-0ubuntu0.18.04"
	    size: 3106816
	    packfiles: true
	    files:
	      # Total files used: 2.78 KB
	      # Installed package size: 2.96 MB
	      - "/usr/share/zoneinfo/America/Los_Angeles" # 2.78 KB
	
	other_files: 	# This is a list of files used by the runs but not considered to be provided by
					# the packages above. This distinction is NOT IN DATABASE.
					# Moreover, two files below are symbolic links to files that are provided by packages
					# above.

	  - "/etc/ld.so.cache" # 130.37 KB
	  - "/etc/localtime" # Link to /usr/share/zoneinfo/America/Los_Angeles
	  - "/lib64/ld-linux-x86-64.so.2" # Link to /lib/x86_64-linux-gnu/ld-2.27.so
	  - "/linfast/GitRepos/wt-prov-model/toolkits/reprozip/scratch" # Directory
	  - "/usr/lib/locale/locale-archive" # 2.87 MB

	. . .
	```
- It is clear that much run-time environment information is stored only in `config.yml`.

### Identified database contents not stored in the YAML file

- For each table in database identified which attributes correspond to information in the `config.yml` file.  Information present *only* in the database is identified as NOT IN YAML FILE.

- For table `processes` 
	```
 	run_id
 	parent    	# NOT IN YAML FILE.    
 	timestamp 	# NOT IN YAML FILE
 	is_thread 	# NOT IN YAML FILE   
 	exitcode 	 
	```
- For table `executed_files`:
	```
	name       
	run_id         
	timestamp  # NOT IN YAML FILE   
	process    # NOT IN YAML FILE   
	argv           
	envp           
	workingdir 
	```
- For table `opened_files`:
	```
	run_id       
	name             
	timestamp    # NOT IN YAML FILE     
	mode         # NOT IN YAML FILE     
	is_directory # NOT IN YAML FILE (only in comments)
	process      # NOT IN YAML FILE 
	```
	 
- It appears that the database uniquely contains the information needed build the graph of process-process, and process-file dependencies. These graphs cannot be built from the contents of `config.yml` alone.

- The database additionally stores timestamps for processes, execution, and file open events.


### Conclusions

- We may need both to parse the `config.yml` file *and* query the `trace.sqlite3` file to get all the information we need to satisfy provenance queries for Whole Tale.
